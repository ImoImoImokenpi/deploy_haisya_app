{% extends "layout.html" %}
{% block content %}

<header class="custom-header mb-3">
    <h2 class="mx-auto text-start fs-4">realjamの配車</h2>
</header>

<section class="vh-100 gradient-custom">
    <div class="container py-5 h-100">
        <div class="row d-flex justify-content-center h-100">
            <div class="col-12 col-md-8 col-lg-7 col-xl-6">

                <h3 class="text-center mb-4">マッチング方式を選択してください</h3>

                <!-- スコアマッチング -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-body text-center">
                        <h5 class="card-title">スコアマッチング</h5>
                        <p class="card-text">
                            属性（年代・ジャンル・セクション・リハ参加）を考慮し、
                            最も相性が良い組み合わせを優先して配車します。
                        </p>
                        <button class="btn btn-primary rounded-pill px-4" onclick="openGradeModal('score')">
                            この方式で配車する
                        </button>
                    </div>
                </div>

                <!-- ランダムマッチング -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-body text-center">
                        <h5 class="card-title">ランダムマッチング</h5>
                        <p class="card-text">
                            完全にランダムで配車します。<br>
                            新しい出会いが生まれるかも？
                        </p>
                        <button class="btn btn-success rounded-pill px-4" onclick="openGradeModal('random')">
                            この方式で配車する
                        </button>
                    </div>
                </div>

                <!-- セクション優先 -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-body text-center">
                        <h5 class="card-title">セクション優先</h5>
                        <p class="card-text">
                            同じセクションを最優先にして配車します。<br>
                            リハーサルの順番を重視した方式です。
                        </p>
                        <button class="btn btn-warning rounded-pill px-4 text-white" onclick="openGradeModal('section')">
                            この方式で配車する
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

<!-- 学年（年代）選択モーダル -->
<form id="gradeForm" method="GET">
    <div class="modal fade" id="gradeModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content rounded-4 shadow-lg p-3">
                <div class="modal-header border-0">
                    <h5 class="modal-title">あなたの年代を選択してください</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
                </div>
                <div class="modal-body text-center">
                    <select id="gradeSelect" name="age" class="form-select form-select-lg rounded-pill" required>
                        <option value="">選択してください</option>
                        <option value="25">25代</option>
                        <option value="26">26代</option>
                        <option value="27">27代</option>
                        <option value="28">28代</option>
                        <option value="29">29代</option>
                        <option value="30">30代</option>
                        <option value="31">31代</option>
                        <option value="32">32代</option>
                    </select>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="submit" class="btn btn-primary rounded-pill px-4">決定</button>
                    <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">キャンセル</button>
                </div>
            </div>
        </div>
    </div>
</form>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
let selectedMode = '';

function openGradeModal(mode) {
    selectedMode = mode;
    const form = document.getElementById('gradeForm');
    // 選択した配車方式をGETパラメータとしてURLに追加
    form.action = "{{ url_for('matching.match', mode='') }}" + selectedMode;
    const modal = new bootstrap.Modal(document.getElementById('gradeModal'));
    modal.show();
}
</script>

{% endblock %}
